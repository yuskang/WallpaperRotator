# PRD: WallpaperRotator v2.0

> Windows 平板螢幕旋轉自動切換桌布解決方案

| 欄位 | 內容 |
|------|------|
| **產品名稱** | WallpaperRotator |
| **版本** | v2.0 |
| **文檔版本** | 1.0 |
| **建立日期** | 2026-01-30 |
| **負責人** | Product Manager Agent |
| **狀態** | Draft |

---

## 1. 執行摘要

### 1.1 產品願景

打造 Windows 平板用戶的桌布智能切換工具，讓螢幕旋轉時桌布自動適配，提供無縫的視覺體驗。

### 1.2 問題陳述

Windows 作業系統原生不支援「依據螢幕方向自動切換桌布」功能。當平板從橫向旋轉至直向時：

- 橫向桌布被裁切或壓縮
- 留白區域破壞視覺美感
- 用戶需手動更換桌布，體驗割裂

### 1.3 解決方案

提供一個輕量級、事件驅動的背景服務，自動偵測螢幕方向變化並即時切換對應桌布。

### 1.4 目標用戶

| 用戶類型 | 描述 | 優先級 |
|----------|------|--------|
| **主要用戶** | Windows 平板用戶 (Surface、Fujitsu Q系列、Lenovo Yoga 等) | P0 |
| **次要用戶** | 外接旋轉螢幕的桌面用戶 | P1 |
| **潛在用戶** | 多螢幕工作者 (不同螢幕方向) | P2 |

---

## 2. 產品目標與成功指標

### 2.1 產品目標

| 目標 | 描述 | 時間範圍 |
|------|------|----------|
| **G1** | 發布穩定可用的 v2.0 版本，支援 GUI 配置 | Q1 2026 |
| **G2** | 達成 1,000 活躍用戶 | Q2 2026 |
| **G3** | 推出 Pro 付費版本 | Q3 2026 |

### 2.2 關鍵成功指標 (KPIs)

| 指標 | 目標值 | 衡量方式 |
|------|--------|----------|
| **安裝成功率** | ≥ 95% | 安裝完成 / 安裝嘗試 |
| **切換延遲** | ≤ 500ms | 螢幕旋轉到桌布更新的時間 |
| **CPU 佔用率** | ≤ 0.1% | 背景執行時平均 CPU 使用 |
| **記憶體佔用** | ≤ 20MB | 背景執行時記憶體使用 |
| **用戶留存率 (7日)** | ≥ 80% | 7日後仍在使用的用戶比例 |
| **NPS 評分** | ≥ 40 | 淨推薦值 |

---

## 3. 功能需求

### 3.1 功能總覽

```
┌─────────────────────────────────────────────────────────────┐
│                    WallpaperRotator v2.0                     │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 核心引擎    │  │ 系統托盤    │  │ 設定介面            │  │
│  │ (背景服務)  │  │ (快速操作)  │  │ (完整配置)          │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│         │                │                    │              │
│         ▼                ▼                    ▼              │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    配置管理模組                          ││
│  │              (config.json / 註冊表)                      ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

### 3.2 功能清單

#### P0 - 必須實現 (MVP)

| ID | 功能 | 描述 | 驗收標準 |
|----|------|------|----------|
| **F-001** | 螢幕方向偵測 | 使用 Windows API 即時偵測螢幕方向 | 延遲 ≤ 500ms，準確率 100% |
| **F-002** | 自動桌布切換 | 根據方向自動套用對應桌布 | 切換成功率 100%，無閃爍 |
| **F-003** | 背景靜默執行 | 無視窗、無干擾的背景運行 | 用戶無感知，無視窗彈出 |
| **F-004** | 開機自啟動 | 系統啟動後自動執行 | 支援啟用/停用切換 |
| **F-005** | 系統托盤圖示 | 托盤區顯示狀態圖示 | 顯示當前狀態，右鍵選單操作 |
| **F-006** | 基礎設定介面 | GUI 配置圖片路徑 | 檔案瀏覽器選擇，即時預覽 |

#### P1 - 應該實現 (v2.1)

| ID | 功能 | 描述 | 驗收標準 |
|----|------|------|----------|
| **F-007** | 多圖輪換 | 支援多張圖片隨機/順序輪換 | 每個方向支援 ≤ 20 張圖片 |
| **F-008** | 桌布顯示模式 | 支援 Fit/Fill/Stretch/Center 等模式 | 所有 Windows 原生模式 |
| **F-009** | 過渡動畫 | 桌布切換時的淡入淡出效果 | 可配置動畫時長 (0-1000ms) |
| **F-010** | 排程切換 | 依時間排程更換桌布組合 | 日/夜模式自動切換 |
| **F-011** | 錯誤日誌 | 記錄運行狀態和錯誤 | 可匯出日誌檔案 |

#### P2 - 可以實現 (v2.2+)

| ID | 功能 | 描述 | 驗收標準 |
|----|------|------|----------|
| **F-012** | 多螢幕支援 | 獨立控制每個螢幕的桌布 | 自動偵測螢幕數量和方向 |
| **F-013** | 主題包市場 | 下載社群分享的桌布主題包 | 支援匯入/匯出主題包 |
| **F-014** | 雲端同步 | 跨設備同步設定和桌布 | OneDrive/Google Drive 整合 |
| **F-015** | 熱鍵支援 | 自訂快捷鍵手動切換 | 可配置全域熱鍵 |
| **F-016** | 動態桌布 | 支援影片/動態 GIF 作為桌布 | 可配置播放行為 |

### 3.3 用戶故事

#### US-001: 首次安裝配置
```
作為一個 Windows 平板用戶
我希望 安裝後能快速配置橫向和直向的桌布
以便 立即享受自動切換功能

驗收標準:
1. 安裝程式提供圖片選擇步驟
2. 支援拖放圖片到配置視窗
3. 即時預覽選擇的圖片
4. 一鍵完成配置並啟動服務
```

#### US-002: 日常使用
```
作為一個 平板電腦用戶
我希望 旋轉螢幕時桌布自動且即時切換
以便 保持美觀的桌面視覺體驗

驗收標準:
1. 螢幕旋轉後 500ms 內桌布完成切換
2. 切換過程無閃爍或黑屏
3. 不影響正在使用的應用程式
```

#### US-003: 快速存取控制
```
作為一個 進階用戶
我希望 透過系統托盤快速暫停/恢復功能
以便 在特定情況下暫時停用自動切換

驗收標準:
1. 托盤圖示顯示當前狀態 (運行中/已暫停)
2. 左鍵點擊切換狀態
3. 右鍵選單提供完整選項
```

#### US-004: 多圖輪換
```
作為一個 追求個性化的用戶
我希望 為每個方向設定多張桌布並自動輪換
以便 每次旋轉都有不同的視覺驚喜

驗收標準:
1. 支援添加多張圖片到橫向/直向列表
2. 可選擇隨機或順序輪換
3. 可設定輪換間隔時間
```

---

## 4. 非功能需求

### 4.1 效能需求

| 需求 | 指標 | 說明 |
|------|------|------|
| **NFR-001** | CPU 佔用 ≤ 0.1% | 背景運行時平均值 |
| **NFR-002** | 記憶體 ≤ 20MB | 穩態運行記憶體使用 |
| **NFR-003** | 啟動時間 ≤ 3s | 從執行到進入監控狀態 |
| **NFR-004** | 切換延遲 ≤ 500ms | 事件觸發到桌布更新 |
| **NFR-005** | 電池影響 < 1% | 8小時使用對電量的影響 |

### 4.2 相容性需求

| 需求 | 說明 |
|------|------|
| **NFR-006** | Windows 10 (1903+) 完整支援 |
| **NFR-007** | Windows 11 完整支援 |
| **NFR-008** | x64 和 ARM64 架構支援 |
| **NFR-009** | 高 DPI 顯示器支援 (最高 300% 縮放) |
| **NFR-010** | 與 Windows Spotlight 共存 (用戶選擇優先) |

### 4.3 安全性需求

| 需求 | 說明 |
|------|------|
| **NFR-011** | 不需要管理員權限執行 |
| **NFR-012** | 不收集用戶個人資料 |
| **NFR-013** | 無網路連線需求 (離線可用) |
| **NFR-014** | 程式碼簽章 (避免 SmartScreen 警告) |

### 4.4 可用性需求

| 需求 | 說明 |
|------|------|
| **NFR-015** | 3 步內完成首次配置 |
| **NFR-016** | 支援繁體中文、簡體中文、英文 UI |
| **NFR-017** | 符合 WCAG 2.1 AA 級無障礙標準 |

---

## 5. 技術規格

### 5.1 系統架構

```
┌──────────────────────────────────────────────────────────────────┐
│                         WallpaperRotator v2.0                     │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                      表現層 (Presentation)                   │ │
│  │  ┌───────────────┐  ┌───────────────┐  ┌─────────────────┐  │ │
│  │  │ 系統托盤圖示  │  │  設定視窗     │  │  首次配置精靈   │  │ │
│  │  │ (NotifyIcon)  │  │  (WPF/WinUI)  │  │  (Wizard)       │  │ │
│  │  └───────────────┘  └───────────────┘  └─────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                  │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                      業務邏輯層 (Business)                   │ │
│  │  ┌───────────────┐  ┌───────────────┐  ┌─────────────────┐  │ │
│  │  │ 方向偵測服務  │  │  桌布切換服務 │  │  配置管理服務   │  │ │
│  │  │ (Detector)    │  │  (Switcher)   │  │  (ConfigMgr)    │  │ │
│  │  └───────────────┘  └───────────────┘  └─────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                  │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                      基礎設施層 (Infrastructure)             │ │
│  │  ┌───────────────┐  ┌───────────────┐  ┌─────────────────┐  │ │
│  │  │ Windows API   │  │  註冊表操作   │  │  檔案系統       │  │ │
│  │  │ (P/Invoke)    │  │  (Registry)   │  │  (FileSystem)   │  │ │
│  │  └───────────────┘  └───────────────┘  └─────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

### 5.2 技術選型

| 層級 | 技術選擇 | 理由 |
|------|----------|------|
| **語言** | C# (.NET 8) | 跨平台、效能佳、Windows 整合度高 |
| **UI 框架** | WinUI 3 | 現代 Windows 原生 UI、支援 Win10/11 |
| **打包** | MSIX | 現代化打包、自動更新支援 |
| **安裝程式** | Inno Setup (備選) | 傳統安裝需求相容 |
| **API 存取** | P/Invoke + CsWin32 | 類型安全的 Windows API 呼叫 |

### 5.3 核心 API 使用

```csharp
// 螢幕方向偵測 - 事件驅動方案
DisplayInformation.DisplayContentsInvalidated += OnDisplayChanged;

// 備選: WMI 事件訂閱
ManagementEventWatcher watcher = new ManagementEventWatcher(
    "SELECT * FROM __InstanceModificationEvent " +
    "WHERE TargetInstance ISA 'Win32_DesktopMonitor'"
);

// 桌布設定
[DllImport("user32.dll", CharSet = CharSet.Auto)]
static extern int SystemParametersInfo(
    int uAction,    // SPI_SETDESKWALLPAPER = 0x0014
    int uParam,
    string lpvParam,
    int fuWinIni    // SPIF_UPDATEINIFILE | SPIF_SENDCHANGE
);
```

### 5.4 配置檔案格式

```json
{
  "$schema": "https://wallpaperrotator.app/schema/config-v2.json",
  "version": "2.0",
  "settings": {
    "enabled": true,
    "startWithWindows": true,
    "displayMode": "Fit",
    "backgroundColor": "#000000",
    "transitionDuration": 200,
    "checkInterval": 500
  },
  "wallpapers": {
    "landscape": {
      "mode": "sequential",
      "images": [
        "C:\\Wallpapers\\landscape-1.png",
        "C:\\Wallpapers\\landscape-2.png"
      ],
      "rotateInterval": 3600
    },
    "portrait": {
      "mode": "random",
      "images": [
        "C:\\Wallpapers\\portrait-1.png"
      ],
      "rotateInterval": 0
    }
  },
  "schedule": {
    "enabled": false,
    "rules": []
  }
}
```

---

## 6. UI/UX 設計

### 6.1 系統托盤互動

```
┌─────────────────────────────────────────┐
│  [左鍵點擊] → 切換 啟用/暫停 狀態       │
│  [右鍵點擊] → 顯示選單                  │
│       ├── ✓ 啟用自動切換                │
│       ├── ─────────────                 │
│       ├── 立即切換: 橫向                │
│       ├── 立即切換: 直向                │
│       ├── ─────────────                 │
│       ├── 設定...                       │
│       ├── 檢查更新                      │
│       ├── ─────────────                 │
│       └── 結束                          │
└─────────────────────────────────────────┘
```

### 6.2 設定介面線框圖

```
┌──────────────────────────────────────────────────────────────┐
│  WallpaperRotator 設定                              [─][□][×] │
├──────────────────────────────────────────────────────────────┤
│  ┌────────────┐                                              │
│  │ ● 一般     │  一般設定                                    │
│  │   桌布     │  ──────────────────────────────────────      │
│  │   排程     │                                              │
│  │   進階     │  [✓] 開機時自動啟動                          │
│  │   關於     │  [✓] 最小化到系統托盤                        │
│  │            │                                              │
│  │            │  顯示模式:  [Fit (符合)          ▼]          │
│  │            │  背景顏色:  [■ #000000] [選擇...]            │
│  │            │                                              │
│  │            │  偵測間隔:  [500 ] 毫秒                      │
│  │            │  過渡動畫:  [200 ] 毫秒                      │
│  │            │                                              │
│  └────────────┘                                              │
│                                                              │
│                              [套用]  [確定]  [取消]          │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│  WallpaperRotator 設定                              [─][□][×] │
├──────────────────────────────────────────────────────────────┤
│  ┌────────────┐                                              │
│  │   一般     │  桌布設定                                    │
│  │ ● 桌布     │  ──────────────────────────────────────      │
│  │   排程     │                                              │
│  │   進階     │  橫向桌布                    直向桌布        │
│  │   關於     │  ┌──────────────────┐      ┌────────────┐   │
│  │            │  │                  │      │            │   │
│  │            │  │   [預覽圖片]     │      │ [預覽圖片] │   │
│  │            │  │                  │      │            │   │
│  │            │  └──────────────────┘      └────────────┘   │
│  │            │  [+ 添加] [- 移除]         [+ 添加] [- 移除]│
│  │            │                                              │
│  │            │  輪換模式: [順序 ▼]        輪換模式: [隨機 ▼]│
│  │            │  間隔: [3600] 秒           間隔: [不輪換]   │
│  │            │                                              │
│  └────────────┘                                              │
│                                                              │
│                              [套用]  [確定]  [取消]          │
└──────────────────────────────────────────────────────────────┘
```

### 6.3 首次配置精靈

```
步驟 1/3: 歡迎
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

歡迎使用 WallpaperRotator!

此精靈將協助您快速配置自動桌布切換功能。

您需要準備:
• 一張橫向桌布 (建議 1920x1080 或更高)
• 一張直向桌布 (建議 1080x1920 或更高)

                              [下一步 →]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步驟 2/3: 選擇桌布
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

將圖片拖放到下方區域，或點擊選擇檔案

┌────────────────────┐    ┌──────────────┐
│                    │    │              │
│   📷 橫向桌布      │    │  📷 直向桌布 │
│   拖放或點擊選擇   │    │  拖放或點擊  │
│                    │    │              │
└────────────────────┘    └──────────────┘

                    [← 上一步]  [下一步 →]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步驟 3/3: 完成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✓ 配置完成!

[✓] 開機時自動啟動
[✓] 立即開始運行

旋轉您的平板測試效果吧!

                    [← 上一步]  [完成 ✓]
```

---

## 7. 發布計畫

### 7.1 版本路線圖

```
2026 Q1                    2026 Q2                    2026 Q3
   │                          │                          │
   ▼                          ▼                          ▼
┌─────────┐              ┌─────────┐              ┌─────────┐
│ v2.0    │              │ v2.1    │              │ v2.2    │
│ MVP     │──────────────│ 增強版  │──────────────│ Pro     │
└─────────┘              └─────────┘              └─────────┘
     │                        │                        │
     ├─ 核心切換功能          ├─ 多圖輪換              ├─ 多螢幕支援
     ├─ 系統托盤              ├─ 過渡動畫              ├─ 主題包市場
     ├─ 基礎設定 GUI          ├─ 排程功能              ├─ 雲端同步
     └─ 開機自啟動            └─ 錯誤日誌              └─ 付費功能
```

### 7.2 v2.0 里程碑

| 里程碑 | 內容 | 目標日期 |
|--------|------|----------|
| **M1: 架構設計** | 技術方案確定、專案骨架建立 | 2026-02-07 |
| **M2: 核心引擎** | 事件驅動偵測、桌布切換邏輯 | 2026-02-21 |
| **M3: 系統托盤** | 托盤圖示、選單互動 | 2026-02-28 |
| **M4: 設定介面** | 基礎設定視窗、首次配置精靈 | 2026-03-14 |
| **M5: 測試優化** | 效能優化、相容性測試、Bug 修復 | 2026-03-21 |
| **M6: 發布** | 打包、簽章、文檔、發布 | 2026-03-28 |

### 7.3 發布通路

| 通路 | 優先級 | 說明 |
|------|--------|------|
| **GitHub Releases** | P0 | 開源社群、直接下載 |
| **Microsoft Store** | P1 | 官方通路、自動更新 |
| **Winget** | P1 | 命令列安裝 |
| **官方網站** | P2 | 品牌建設、直接下載 |

---

## 8. 風險評估

### 8.1 技術風險

| 風險 | 機率 | 影響 | 緩解措施 |
|------|------|------|----------|
| Windows API 變更 | 低 | 高 | 使用穩定 API、版本相容層 |
| 高 DPI 顯示問題 | 中 | 中 | 完整 DPI 感知、多解析度測試 |
| ARM64 相容性 | 中 | 中 | 原生 ARM64 編譯、Surface Pro X 測試 |
| 與其他桌布軟體衝突 | 中 | 低 | 偵測衝突、友善提示 |

### 8.2 產品風險

| 風險 | 機率 | 影響 | 緩解措施 |
|------|------|------|----------|
| 用戶安裝困難 | 高 | 高 | 簡化安裝流程、影片教學 |
| 功能不符預期 | 中 | 中 | 早期用戶測試、快速迭代 |
| 效能影響電池 | 低 | 高 | 事件驅動設計、電池模式優化 |

### 8.3 市場風險

| 風險 | 機率 | 影響 | 緩解措施 |
|------|------|------|----------|
| Windows 原生支援此功能 | 低 | 極高 | 差異化功能 (多圖、主題) |
| 競品出現 | 中 | 中 | 先發優勢、社群建設 |

---

## 9. 附錄

### 9.1 術語表

| 術語 | 定義 |
|------|------|
| **桌布** | Windows 桌面背景圖片 |
| **Fit 模式** | 保持圖片比例，可能留白 |
| **Fill 模式** | 填滿螢幕，可能裁切 |
| **系統托盤** | Windows 工作列右側的通知區域 |
| **P/Invoke** | Platform Invocation Services，呼叫原生 API 的機制 |

### 9.2 參考資料

- [Windows Desktop Wallpaper API](https://docs.microsoft.com/windows/win32/api/winuser/nf-winuser-systemparametersinfow)
- [WinUI 3 Documentation](https://docs.microsoft.com/windows/apps/winui/)
- [MSIX Packaging](https://docs.microsoft.com/windows/msix/)

### 9.3 變更記錄

| 版本 | 日期 | 作者 | 變更內容 |
|------|------|------|----------|
| 1.0 | 2026-01-30 | Product Manager Agent | 初始版本 |

---

## 10. 審批

| 角色 | 姓名 | 日期 | 簽章 |
|------|------|------|------|
| Product Manager | | | ☐ |
| Architect | | | ☐ |
| Tech Lead | | | ☐ |
| Stakeholder | | | ☐ |

---

*Document generated by AI Agent Team*
