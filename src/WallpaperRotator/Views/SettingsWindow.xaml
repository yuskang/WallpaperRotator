<Window x:Class="WallpaperRotator.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="WallpaperRotator 設定"
        Height="580" Width="700"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResizeWithGrip"
        MinHeight="500" MinWidth="600"
        Background="{DynamicResource BackgroundBrush}">

    <Window.Resources>
        <!-- Loading Overlay Style -->
        <Style x:Key="LoadingOverlayStyle" TargetType="Border">
            <Setter Property="Background" Value="#80000000"/>
            <Setter Property="Visibility" Value="Collapsed"/>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Main Content -->
        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,8">
                <TextBlock Text="WallpaperRotator"
                           Style="{StaticResource HeaderTextStyle}"/>
                <TextBlock Text="Windows 平板螢幕旋轉自動切換桌布設定"
                           Style="{StaticResource CaptionTextStyle}"
                           Margin="0,4,0,0"/>
            </StackPanel>

            <!-- Loading Indicator -->
            <ProgressBar x:Name="LoadingBar"
                         Grid.Row="1"
                         Style="{StaticResource LoadingIndicatorStyle}"
                         Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}"
                         Margin="0,8,0,16"/>

            <!-- Content Tabs -->
            <TabControl Grid.Row="2"
                        Style="{StaticResource ModernTabControlStyle}"
                        Margin="0,8,0,0">

                <!-- 一般設定 Tab -->
                <TabItem Header="一般" Style="{StaticResource ModernTabItemStyle}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,16,0,0">
                        <StackPanel>
                            <!-- 啟用設定卡片 -->
                            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="自動化設定" Style="{StaticResource TitleTextStyle}" Margin="0,0,0,16"/>

                                    <CheckBox Content="啟用自動切換"
                                              IsChecked="{Binding Enabled}"
                                              Style="{StaticResource ModernCheckBoxStyle}"
                                              Margin="0,0,0,12"/>

                                    <TextBlock Text="當螢幕方向改變時，自動切換對應的桌布"
                                               Style="{StaticResource CaptionTextStyle}"
                                               Margin="28,0,0,16"/>

                                    <CheckBox Content="開機時自動啟動"
                                              IsChecked="{Binding StartWithWindows}"
                                              Style="{StaticResource ModernCheckBoxStyle}"/>

                                    <TextBlock Text="Windows 登入後自動啟動 WallpaperRotator"
                                               Style="{StaticResource CaptionTextStyle}"
                                               Margin="28,4,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- 顯示設定卡片 -->
                            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="顯示設定" Style="{StaticResource TitleTextStyle}" Margin="0,0,0,16"/>

                                    <TextBlock Text="顯示模式" Style="{StaticResource BodyTextStyle}" Margin="0,0,0,8"/>
                                    <ComboBox ItemsSource="{Binding DisplayModes}"
                                              SelectedItem="{Binding DisplayMode}"
                                              Style="{StaticResource ModernComboBoxStyle}"
                                              Width="220" HorizontalAlignment="Left"
                                              Margin="0,0,0,16"/>

                                    <TextBlock Text="背景顏色 (留白區)" Style="{StaticResource BodyTextStyle}" Margin="0,0,0,8"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Text="{Binding BackgroundColor, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 Width="120"/>
                                        <Border Grid.Column="1"
                                                Width="36" Height="36"
                                                CornerRadius="4"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="1"
                                                Margin="12,0,0,0">
                                            <Border.Background>
                                                <SolidColorBrush Color="{Binding BackgroundColor, FallbackValue=#000000}"/>
                                            </Border.Background>
                                        </Border>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- 動畫設定卡片 -->
                            <Border Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock Text="動畫設定" Style="{StaticResource TitleTextStyle}" Margin="0,0,0,16"/>

                                    <TextBlock Text="過渡動畫時間 (毫秒)" Style="{StaticResource BodyTextStyle}" Margin="0,0,0,8"/>
                                    <TextBox Text="{Binding TransitionDurationMs}"
                                             Style="{StaticResource ModernTextBoxStyle}"
                                             Width="120" HorizontalAlignment="Left"/>
                                    <TextBlock Text="設定桌布切換時的淡入淡出動畫時長，0 表示無動畫"
                                               Style="{StaticResource CaptionTextStyle}"
                                               Margin="0,8,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- 桌布設定 Tab -->
                <TabItem Header="桌布" Style="{StaticResource ModernTabItemStyle}">
                    <Grid Margin="0,16,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="24"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 橫向桌布卡片 -->
                        <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <Ellipse Width="12" Height="12" Fill="#0078D4" Margin="0,0,8,0"/>
                                    <TextBlock Text="橫向桌布" Style="{StaticResource TitleTextStyle}"/>
                                </StackPanel>

                                <Border Grid.Row="1"
                                        Style="{StaticResource ImagePreviewBorderStyle}"
                                        MinHeight="160">
                                    <Grid>
                                        <Image x:Name="LandscapePreview"
                                               Stretch="Uniform"
                                               Margin="8"/>
                                        <!-- 無圖片提示 -->
                                        <StackPanel VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    Visibility="{Binding LandscapeImagePath, Converter={StaticResource NullToVisibilityConverter}, FallbackValue=Visible}">
                                            <TextBlock Text="尚未選擇圖片"
                                                       Style="{StaticResource CaptionTextStyle}"
                                                       HorizontalAlignment="Center"/>
                                            <TextBlock Text="點擊下方按鈕選擇橫向桌布"
                                                       Style="{StaticResource CaptionTextStyle}"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <TextBox Grid.Row="2"
                                         Text="{Binding LandscapeImagePath}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         IsReadOnly="True"
                                         Margin="0,12,0,0"/>

                                <Button Grid.Row="3"
                                        Content="瀏覽圖片..."
                                        Command="{Binding BrowseLandscapeCommand}"
                                        Style="{StaticResource ModernButtonStyle}"
                                        HorizontalAlignment="Left"
                                        Margin="0,12,0,0"/>
                            </Grid>
                        </Border>

                        <!-- 直向桌布卡片 -->
                        <Border Grid.Column="2" Style="{StaticResource CardStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <Ellipse Width="12" Height="12" Fill="#107C10" Margin="0,0,8,0"/>
                                    <TextBlock Text="直向桌布" Style="{StaticResource TitleTextStyle}"/>
                                </StackPanel>

                                <Border Grid.Row="1"
                                        Style="{StaticResource ImagePreviewBorderStyle}"
                                        MinHeight="160">
                                    <Grid>
                                        <Image x:Name="PortraitPreview"
                                               Stretch="Uniform"
                                               Margin="8"/>
                                        <!-- 無圖片提示 -->
                                        <StackPanel VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    Visibility="{Binding PortraitImagePath, Converter={StaticResource NullToVisibilityConverter}, FallbackValue=Visible}">
                                            <TextBlock Text="尚未選擇圖片"
                                                       Style="{StaticResource CaptionTextStyle}"
                                                       HorizontalAlignment="Center"/>
                                            <TextBlock Text="點擊下方按鈕選擇直向桌布"
                                                       Style="{StaticResource CaptionTextStyle}"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <TextBox Grid.Row="2"
                                         Text="{Binding PortraitImagePath}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         IsReadOnly="True"
                                         Margin="0,12,0,0"/>

                                <Button Grid.Row="3"
                                        Content="瀏覽圖片..."
                                        Command="{Binding BrowsePortraitCommand}"
                                        Style="{StaticResource ModernButtonStyle}"
                                        HorizontalAlignment="Left"
                                        Margin="0,12,0,0"/>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- 關於 Tab -->
                <TabItem Header="關於" Style="{StaticResource ModernTabItemStyle}">
                    <Border Style="{StaticResource CardStyle}" Margin="0,16,0,0">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <!-- App Icon -->
                            <Border Width="80" Height="80"
                                    CornerRadius="16"
                                    Background="{DynamicResource PrimaryBrush}"
                                    Margin="0,0,0,24">
                                <TextBlock Text="WR"
                                           FontSize="32"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>

                            <TextBlock Text="WallpaperRotator"
                                       Style="{StaticResource HeaderTextStyle}"
                                       HorizontalAlignment="Center"/>

                            <Border Background="{DynamicResource PrimaryBrush}"
                                    CornerRadius="12"
                                    Padding="12,4"
                                    Margin="0,8,0,24"
                                    HorizontalAlignment="Center">
                                <TextBlock Text="v2.0.0"
                                           FontSize="14"
                                           Foreground="White"/>
                            </Border>

                            <TextBlock Text="Windows 平板螢幕旋轉自動切換桌布工具"
                                       Style="{StaticResource BodyTextStyle}"
                                       HorizontalAlignment="Center"/>

                            <TextBlock Text="適用於 Fujitsu Q7311 / Surface 等平板電腦"
                                       Style="{StaticResource CaptionTextStyle}"
                                       HorizontalAlignment="Center"
                                       Margin="0,8,0,24"/>

                            <Border Height="1"
                                    Background="{DynamicResource DividerBrush}"
                                    Width="300"
                                    Margin="0,0,0,24"/>

                            <TextBlock Style="{StaticResource CaptionTextStyle}"
                                       HorizontalAlignment="Center"
                                       TextAlignment="Center">
                                <Run Text="Built with .NET 8 and WPF"/>
                                <LineBreak/>
                                <Run Text="Clean Architecture Design"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </TabItem>
            </TabControl>

            <!-- Footer Buttons -->
            <Border Grid.Row="3"
                    BorderBrush="{DynamicResource DividerBrush}"
                    BorderThickness="0,1,0,0"
                    Margin="0,16,0,0"
                    Padding="0,16,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 左側狀態指示 -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <Ellipse x:Name="StatusIndicator"
                                 Width="8" Height="8"
                                 Fill="{DynamicResource SuccessBrush}"
                                 Margin="0,0,8,0"/>
                        <TextBlock x:Name="StatusText"
                                   Text="已儲存"
                                   Style="{StaticResource CaptionTextStyle}"/>
                    </StackPanel>

                    <!-- 右側按鈕 -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Content="重設"
                                Command="{Binding ResetCommand}"
                                Style="{StaticResource OutlineButtonStyle}"
                                Margin="0,0,12,0"/>
                        <Button Content="取消"
                                Command="{Binding CancelCommand}"
                                Style="{StaticResource ModernButtonStyle}"
                                Margin="0,0,12,0"/>
                        <Button Content="儲存"
                                Command="{Binding SaveCommand}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                IsDefault="True"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Border x:Name="LoadingOverlay"
                Style="{StaticResource LoadingOverlayStyle}"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True"
                             Width="200" Height="4"
                             Foreground="{DynamicResource PrimaryBrush}"/>
                <TextBlock Text="載入中..."
                           Foreground="White"
                           Margin="0,16,0,0"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
